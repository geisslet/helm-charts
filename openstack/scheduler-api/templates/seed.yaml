{{- $vbase  := .Values.global.vaultBaseURL | required "missing value for .Values.global.vaultBaseURL" -}}
{{- $region := .Values.global.region       | required "missing value for .Values.global.region"       -}}

apiVersion: "openstack.stable.sap.cc/v1"
kind: "OpenstackSeed"
metadata:
  name: scheduler-api-seed
spec:
  requires:
  - {{ .Values.global.keystoneNamespace }}/keystone-seed
  - monsoon3/domain-ccadmin-seed

  domains:
  - name: Default
    users:
    - name: scheduler-api
      description: "Scheduler API user for CC. This user was automatically generated by a user seed: https://github.com/sapcc/helm-charts/tree/master/openstack/scheduler-api/"
      # TODO: Use another secret
      password: {{ printf "%s/qa-de-1/cerebro/keystone-user/service/password" $vbase | quote }}
      role_assignments:
      - project: service
        role:    service

  - name: ccadmin
    projects:
    - name: cerebro
      role_assignments:
      - user: scheduler-api@Default
        role: member
